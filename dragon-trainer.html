<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dragon Trainer Articles</title>
    <style>
        #author {
            background: #aaaaaa;
            padding: 2rem;
            border-radius: 10px;
            width: 70%;
            margin: 0 auto;
        }
        a, a:visited {
            text-decoration: none;
            color: blue;
        }
    </style>
</head>
<body>
    <div id="app">
    <div>
</body>
<script>
    // https://vanillajsacademy.com/api/dragons.json
    // https://vanillajsacademy.com/api/dragons-author.json

    let app = document.querySelector('#app');

    // Catch errors
    function renderFail() {
        app.innerHTML = "<h3>All Was Burned</h3>"
        app.innerHTML += "<em>Published on July 30, 2023 by someone</em>";
        app.innerHTML += "<p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Non eaque molestiae cumque neque expedita necessitatibus nemo? Suscipit harum molestiae, error repellat, sunt itaque iste nemo, illum quam necessitatibus temporibus aliquam!</p>"
    }

    // Render author bio if it exists
    function getAuthor(author_key, authors_obj) {
        return authors_obj.find((authors) => {
            return authors.author === author_key;
        });
    }
        
    // Render articles
    function render(articles_obj, authors_obj) {

        if (!articles_obj || articles_obj < 1) {
            renderFail();
            return;
        }

        app.innerHTML = articles_obj.map((article) => {
            let authors = getAuthor(article.author, authors_obj);
            let render = `<article><a href="${article.url}"><h3>${article.title}</h3></a><em>Published on ${article.pubdate} by ${article.author}</em><p>${article.article}</p></article>`;
            render += `<article id="author"><h3>${authors.author}</h3><p>${authors.bio}</p></article>`;
            return render;
        }).join('');
    }

    // Fetch article
    function getArticle() {
        Promise.all([
            fetch('json/dragons.json'),
            fetch('json/dragons-author.json')
        ]).then((responses) => {
            return Promise.all(responses.map((response) => {
                if (response.ok) {
                    return response.json();
                }
                throw response.status;
            }))
        }).then((data) => {
            render(data[0].articles, data[1].authors);
        }).catch((error) => {
            console.warn(error);
            renderFail();
        });
    }

    getArticle();
    
</script>
</html>

